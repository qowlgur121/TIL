## 웹 애플리케이션의 이해

### 웹 서버와 웹 애플리케이션 서버

![img.png](img.png)  
![img_1.png](img_1.png)

웹 서버와 웹 애플리케이션 서버는 둘 다 비슷한 기능을 제공하지만 어떤 것에 특화되어 있느냐에 중요하다.
웹 서버는 미리 준비된 정적 데이터를 제공하는데 특화되어있고, 웹 애플리케이션 서버는 요청을 애플리케이션의 코드를 실행하여 해석하고 가공된 동적 데이터를 제공하는데 특화되어있다.  

웹 시스템 구성은 아래와 같다.  
![img_2.png](img_2.png)
이렇게 구성한 이유는 웹 서버는 로직이 단순하여 잘 죽지 않는데 웹 애플리케이션 서버는 잘 죽는다. 
![img_3.png](img_3.png)
그래서 저렇게 배치를 하는 것이고 만약 웹 애플리케이션 서버가 죽으면 웹 서버가 오류 html을 제공하면 된다.
![img_4.png](img_4.png)
이런 구성은 부하에 따라 서버의 양을 증설하여 효율적으로 관리할 수 있다.

### 서블릿

![img_5.png](img_5.png)
웹 애플리케이션 서버를 개발자가 개발하려면 저런 요청을 해석하고 비지니스 로직, 응답을 만들어 전송하는 모든 부분을 개발해야 하는데
모든 개발자들이 저런 부분을 만들면 비효율적이다. 
그래서 웹 애플리케이션 서버의 비지니스 로직만 집중하여 개발자가 개발할 수 있게 다른 부분의 기능을 제공하는 것이 서블릿이다

![img_6.png](img_6.png)
![img_7.png](img_7.png)
과정은 이러하다.
[클라이언트] --> HTTP 요청 --> [웹 애플리케이션 서버 (Tomcat 등)]
서블릿을 지원하는 웹 애플리케이션 서버를 서블릿 컨테이너라고 한다. 서블릿을 관리하니까.

1. WAS는 요청 URL에 맞는 서블릿을 찾고, 서블릿 객체를 생성한다. (싱글톤).
2. WAS는  HttpServletRequest 객체를 생성하여 요청 정보를 담고, 빈 HttpServletResponse 객체를 생성한다.
3. WAS는 서블릿 객체의 service() 메서드를 호출하고, HttpServletRequest, HttpServletResponse 객체를 넘겨준다.
4. [서블릿]
    * HttpServletRequest 객체에서 필요한 정보를 꺼낸다.
    * 비즈니스 로직을 수행하여 결과를 생성한다.
    * HttpServletResponse 객체에 응답 정보를 담는다.
5. [웹 애플리케이션 서버]  HttpServletResponse 객체를 기반으로 HTTP 응답을 생성하여 클라이언트에게 전송합니다.

![img_8.png](img_8.png)
서블릿 객체를 싱글톤으로 관리한다.

### WAS는 멀티 쓰레드를 지원한다
![img_9.png](img_9.png)
서블릿은 누가 호출할까? 쓰레드가 호출한다.
쓰레드? 일단 프로그램은 디스크에 적재된 정직 상태인 파일이다. 이 프로그램을 실행하면 운영체제를 메모리에 적재하는데 여러 프로세스로 적재 시킨다.
CPU는 프로세서이다. 이 CPU의 작업 단위가 쓰레드이다. 이 쓰레드는 한번에 한 줄의 코드를 읽을 수 있다. 하나의 프로세스를 여러 쓰레드들이 담당하여 처리한다.

![img_10.png](img_10.png)
자 다시 돌아와서 서블릿이 호출된다고 치자. 이 서블릿을 하나의 쓰레드가 처리하고 있는데 만약 다른 여러 요청이 들어오면 이 쓰레드가 처리할 때까지 기다려야 한다.
그러면 굉장히 시간이 많이 걸릴 것이다. 이 서블릿의 요청이 들어올 때마다 쓰레드를 생성하고 처리한다음 쓰레드를 없애면 이렇게 기다릴 필요없이 
바로바로 처리할 수 있을 것이다. 그런데 이렇게 서블릿의 요청마다 쓰레드를 생성하면 비용이 많이 든다. 예로 생성하는 시간도 있을 것이고
사실 쓰레드라는 건 CPU가 작업을 왔다갔다 하는 것이라 이 왔다갔다하는 컨텍스트 스위칭의 비용이 들고 이 요청이 한 없이 많이 온다면 
서버가 죽을 수도 있다. 이런 것을 해결하기 위해 쓰레드 풀이라는 개념을 도입한다.

#### 쓰레드 풀
![img_11.png](img_11.png)
쓰레드 풀은 먼저 쓰레드들을 생성해 놓고 요청이 들어오면 필요한 쓰레드들을 매칭시켜주는 것이다. 작업이 끝나면 쓰레드를 제거하지 말고
쓰레드 풀로 다시 돌려 놓는다. 이렇게 하면 위의 서버가 수많은 요청들로 죽어버리거나 쓰레드들 생성하고 종료하는 시간들을 절약할 수 있다.

![img_12.png](img_12.png)
실무에서 백엔드 개발자는 상황에 따라 이 쓰레드의 개수값을 잘 설정해야한다.

다행인 것은 이 쓰레드들 생성시키고 이런 것들은 매우 복잡한데 WAS 안에서 알아서 해주는 것이고 개발자는 그 값만 설정해주면 된다는 것이다.


